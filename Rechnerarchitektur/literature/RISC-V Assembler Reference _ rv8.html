<!DOCTYPE html>
<!-- saved from url=(0040)https://michaeljclark.github.io/asm.html -->
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>RISC-V Assembler Reference | rv8</title>
<meta name="generator" content="Jekyll v3.9.0">
<meta property="og:title" content="RISC-V Assembler Reference">
<meta property="og:locale" content="en_US">
<meta name="description" content="RISC-V simulator for x86-64">
<meta property="og:description" content="RISC-V simulator for x86-64">
<link rel="canonical" href="https://michaeljclark.github.io/asm.html">
<meta property="og:url" content="https://michaeljclark.github.io/asm.html">
<meta property="og:site_name" content="rv8">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="RISC-V Assembler Reference">
<script type="application/ld+json">
{"headline":"RISC-V Assembler Reference","description":"RISC-V simulator for x86-64","url":"https://michaeljclark.github.io/asm.html","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com/">
    <link rel="preload" href="./RISC-V Assembler Reference _ rv8_files/css" as="style" type="text/css" crossorigin="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="./RISC-V Assembler Reference _ rv8_files/style.css">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <a id="skip-to-content" href="https://michaeljclark.github.io/asm.html#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">RISC-V Assembler Reference</h1>
      <h2 class="project-tagline">RISC-V simulator for x86-64</h2>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <h2 id="risc-v-assembler-reference">RISC-V Assembler Reference</h2>

<p>This document gives an overview of RISC-V assembly language.
First, an introduction to assembler and linker concepts,
then sections describing assembler directives, pseudo-
instructions, relocation functions, and assembler concepts
such as labels, relative and absolute addressing, immediate
values, constants and finally control and status registers.</p>

<p>The accompanying <a href="https://michaeljclark.github.io/isa">RISC-V Instruction Set Reference</a>
contains a listing of instruction in the <code class="language-plaintext highlighter-rouge">I</code> <em>(Base Integer
Instruction Set)</em> and <code class="language-plaintext highlighter-rouge">M</code> <em>(Multiply and Divide)</em> extension.
For detailed information on the RISC-V instruction set refer to
the <a href="http://riscv.org/specifications/">RISC-V ISA Specification</a>.</p>

<h3 id="concepts">Concepts</h3>

<p>This section briefly covers some high level concepts that
are required to understand the process of assembling and
linking executable code from source files.</p>

<h4 id="assembly-file">Assembly file</h4>

<p>An assembly file contains assembly language directives,
macros and instructions. It can be emitted by a compiler
or it can be handwritten. An assembly file is the input file
to the assembler. The standard extensions for assembly files
are <code class="language-plaintext highlighter-rouge">.s</code> and <code class="language-plaintext highlighter-rouge">.S</code>, with the later indicating that the assembly
file should be pre-processed using the C preprocessor.</p>

<h4 id="relocatable-object-file">Relocatable Object file</h4>

<p>A relocatable object file contains compiled object code and
data emitted by the assembler. An object file cannot be run,
rather it is used as input to the linker. The standard extension
for object files is <code class="language-plaintext highlighter-rouge">.o</code>. The most common cross-platform file
format for RISC-V executables is the ELF <em>(Electronic Linker
Format)</em> object file format. The <code class="language-plaintext highlighter-rouge">objdump</code> utility can be used
to disassemble an object file, <code class="language-plaintext highlighter-rouge">objcopy</code> can be used to copy
and extract sections from ELF files and the <code class="language-plaintext highlighter-rouge">nm</code> utility can
list symbols in an object file.</p>

<h4 id="elf-header">ELF Header</h4>

<p>An ELF file has an ELF header that contains <em>magic</em> to
indicate the file is ELF formatted, the architecture of the
binary, the endianness of the binary <em>(little-endian for RISC-V)</em>,
the ELF file type <em>(Relocatable Object File, Executable File,
Shared Library)</em>, the number of program headers and their offset
in the file, the number of section headers and their offset in
the file, fields indicating the ELF version and ABI <em>(Application
Binary Interface)</em> version of the file and finally flags indicating
various ABI options such as RVC compression and which floating-
point ABI that the executable code in the binary conforms to.</p>

<h4 id="program-header">Program Header</h4>

<p>Program Headers provide size and offsets of loadable segments
within an executable file or shared object along with protection
attributes used by the operating system <em>(read, write and exec)</em>.
Program headers are not present in relocatable object files
and are primarily for use by the operating system to and dynamic
linker to map code and data into memory.</p>

<h4 id="section-header">Section Header</h4>

<p>Section Headers provide size, offset, type, alignment and
flags of the sections contained within the ELF file. Section
headers are not required to execute a static binary but are
necessary for dynamic linking as well as program linking.
Various section types refer to the location of the symbol
table, relocations and dynamic symbols in the ELF binary file.</p>

<h4 id="sections">Sections</h4>

<p>An object file is made up of multiple sections, with each
section corresponding to distinct types of executable code
or data. There are a variety of different section types. This
list shows the four most common sections:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">.text</code> is a read-only section containing executable code</li>
  <li><code class="language-plaintext highlighter-rouge">.data</code> is a read-write section containing global or static variables</li>
  <li><code class="language-plaintext highlighter-rouge">.rodata</code> is a read-only section containing const variables</li>
  <li><code class="language-plaintext highlighter-rouge">.bss</code> is a read-write section containing uninitialized data</li>
</ul>

<h4 id="program-linking">Program linking</h4>

<p>Program linking is the process of reading multiple relocatable
object files, merging the sections from each of the source files,
calculating the new addresses for symbols and applying relocation
fixups to text or data that is pointed to in relocation entries.</p>

<h4 id="linker-script">Linker Script</h4>

<p>A linker script is a text source file that is optionally input
to the linker and it contains rules for the linker to use when
calculating the load address and alignment of the various sections
when creating an executable output file. The standard extension
for linker scripts is <code class="language-plaintext highlighter-rouge">.ld</code>.</p>

<h3 id="assembler-directives">Assembler Directives</h3>

<p>The assembler implements a number of directives that control
the assembly of instructions into an object file. These directives
give the ability to include arbitrary data in the object file,
control exporting of symbols, selection of sections, alignment
of data, assembly options for compression, position dependent
and position independent code.</p>

<p>The following are assembler directives for emitting data:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Directive</th>
      <th style="text-align: left">Arguments</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code><sub>.2byte</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>16-bit comma separated words (unaligned)</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.4byte</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>32-bit comma separated words (unaligned)</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.8byte</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>64-bit comma separated words (unaligned)</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.half</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>16-bit comma separated words (naturally aligned)</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.word</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>32-bit comma separated words (naturally aligned)</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.dword</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>64-bit comma separated words (naturally aligned)</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.byte</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>8-bit comma separated words</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.dtpreldword</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>64-bit thread local word</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.dtprelword</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>32-bit thread local word</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.sleb128</sub></code></td>
      <td style="text-align: left"><sub>expression</sub></td>
      <td style="text-align: left"><sub>signed little endian base 128, DWARF</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.uleb128</sub></code></td>
      <td style="text-align: left"><sub>expression</sub></td>
      <td style="text-align: left"><sub>unsigned little endian base 128, DWARF</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.asciz</sub></code></td>
      <td style="text-align: left"><sub>“string”</sub></td>
      <td style="text-align: left"><sub>emit string (alias for .string)</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.string</sub></code></td>
      <td style="text-align: left"><sub>“string”</sub></td>
      <td style="text-align: left"><sub>emit string</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.incbin</sub></code></td>
      <td style="text-align: left"><sub>“filename”</sub></td>
      <td style="text-align: left"><sub>emit the included file as a binary sequence of octets</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.zero</sub></code></td>
      <td style="text-align: left"><sub>integer</sub></td>
      <td style="text-align: left"><sub>zero bytes</sub></td>
    </tr>
  </tbody>
</table>

<p>The following are assembler directives for control of alignment:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Directive</th>
      <th style="text-align: left">Arguments</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code><sub>.align</sub></code></td>
      <td style="text-align: left"><sub>integer</sub></td>
      <td style="text-align: left"><sub>align to power of 2 (alias for .p2align)</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.balign</sub></code></td>
      <td style="text-align: left"><sub>b,[pad_val=0]</sub></td>
      <td style="text-align: left"><sub>byte align</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.p2align</sub></code></td>
      <td style="text-align: left"><sub>p2,[pad_val=0],max</sub></td>
      <td style="text-align: left"><sub>align to power of 2</sub></td>
    </tr>
  </tbody>
</table>

<p>The following are assembler directives for definition and exporing of symbols:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Directive</th>
      <th style="text-align: left">Arguments</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code><sub>.globl</sub></code></td>
      <td style="text-align: left"><sub>symbol_name</sub></td>
      <td style="text-align: left"><sub>emit symbol_name to symbol table (scope GLOBAL)</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.local</sub></code></td>
      <td style="text-align: left"><sub>symbol_name</sub></td>
      <td style="text-align: left"><sub>emit symbol_name to symbol table (scope LOCAL)</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.equ</sub></code></td>
      <td style="text-align: left"><sub>name, value</sub></td>
      <td style="text-align: left"><sub>constant definition</sub></td>
    </tr>
  </tbody>
</table>

<p>The following directives are for selection of sections:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Directive</th>
      <th style="text-align: left">Arguments</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code><sub>.text</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>emit .text section (if not present) and make current</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.data</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>emit .data section (if not present) and make current</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.rodata</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>emit .rodata section (if not present) and make current</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.bss</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>emit .bss section (if not present) and make current</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.comm</sub></code></td>
      <td style="text-align: left"><sub>symbol_name,size,align</sub></td>
      <td style="text-align: left"><sub>emit common object to .bss section</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.common</sub></code></td>
      <td style="text-align: left"><sub>symbol_name,size,align</sub></td>
      <td style="text-align: left"><sub>emit common object to .bss section</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.section</sub></code></td>
      <td style="text-align: left"><sub>[{.text,.data,.rodata,.bss}]</sub></td>
      <td style="text-align: left"><sub>emit section (if not present, default .text) and make current</sub></td>
    </tr>
  </tbody>
</table>

<p>The following directives includes options, macros and other miscellaneous functions:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Directive</th>
      <th style="text-align: left">Arguments</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code><sub>.option</sub></code></td>
      <td style="text-align: left"><sub>{rvc,norvc,pic,nopic,push,pop}</sub></td>
      <td style="text-align: left"><sub>RISC-V options</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.macro</sub></code></td>
      <td style="text-align: left"><sub>name arg1 [, argn]</sub></td>
      <td style="text-align: left"><sub>begin macro definition \argname to substitute</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.endm</sub></code></td>
      <td style="text-align: left">&nbsp;</td>
      <td style="text-align: left"><sub>end macro definition</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.file</sub></code></td>
      <td style="text-align: left"><sub>“filename”</sub></td>
      <td style="text-align: left"><sub>emit filename FILE LOCAL symbol table</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.ident</sub></code></td>
      <td style="text-align: left"><sub>“string”</sub></td>
      <td style="text-align: left"><sub>accepted for source compatibility</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.size</sub></code></td>
      <td style="text-align: left"><sub>symbol, symbol</sub></td>
      <td style="text-align: left"><sub>accepted for source compatibility</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>.type</sub></code></td>
      <td style="text-align: left"><sub>symbol, @function</sub></td>
      <td style="text-align: left"><sub>accepted for source compatibility</sub></td>
    </tr>
  </tbody>
</table>

<h3 id="assembler-pseudo-instructions">Assembler Pseudo-instructions</h3>

<p>The assembler implements a number of convenience psuedo-instructions
that are formed from instructions in the base ISA, but have implicit
arguments or in some case reversed arguments, that result in distinct
semantics.</p>

<p>The following table lists RISC-V assembler pseudo instructions:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Pesudo-instruction</th>
      <th style="text-align: left">Expansion</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code><sub>nop</sub></code></td>
      <td style="text-align: left"><code><sub>addi zero,zero,0</sub></code></td>
      <td style="text-align: left"><sub>No operation</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>li rd, expression</sub></code></td>
      <td style="text-align: left"><sub>(several expansions)</sub></td>
      <td style="text-align: left"><sub>Load immediate</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>la rd, symbol</sub></code></td>
      <td style="text-align: left"><sub>(several expansions)</sub></td>
      <td style="text-align: left"><sub>Load address</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>mv rd, rs1</sub></code></td>
      <td style="text-align: left"><code><sub>addi rd, rs, 0</sub></code></td>
      <td style="text-align: left"><sub>Copy register</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>not rd, rs1</sub></code></td>
      <td style="text-align: left"><code><sub>xori rd, rs, -1</sub></code></td>
      <td style="text-align: left"><sub>One’s complement</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>neg rd, rs1</sub></code></td>
      <td style="text-align: left"><code><sub>sub rd, x0, rs</sub></code></td>
      <td style="text-align: left"><sub>Two’s complement</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>negw rd, rs1</sub></code></td>
      <td style="text-align: left"><code><sub>subw rd, x0, rs</sub></code></td>
      <td style="text-align: left"><sub>Two’s complement Word</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>sext.w rd, rs1</sub></code></td>
      <td style="text-align: left"><code><sub>addiw rd, rs, 0</sub></code></td>
      <td style="text-align: left"><sub>Sign extend Word</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>seqz rd, rs1</sub></code></td>
      <td style="text-align: left"><code><sub>sltiu rd, rs, 1</sub></code></td>
      <td style="text-align: left"><sub>Set if = zero</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>snez rd, rs1</sub></code></td>
      <td style="text-align: left"><code><sub>sltu rd, x0, rs</sub></code></td>
      <td style="text-align: left"><sub>Set if ≠ zero</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>sltz rd, rs1</sub></code></td>
      <td style="text-align: left"><code><sub>slt rd, rs, x0</sub></code></td>
      <td style="text-align: left"><sub>Set if &lt; zero</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>sgtz rd, rs1</sub></code></td>
      <td style="text-align: left"><code><sub>slt rd, x0, rs</sub></code></td>
      <td style="text-align: left"><sub>Set if &gt; zero</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>fmv.s frd, frs1</sub></code></td>
      <td style="text-align: left"><code><sub>fsgnj.s frd, frs, frs</sub></code></td>
      <td style="text-align: left"><sub>Single-precision move</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>fabs.s frd, frs1</sub></code></td>
      <td style="text-align: left"><code><sub>fsgnjx.s frd, frs, frs</sub></code></td>
      <td style="text-align: left"><sub>Single-precision absolute value</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>fneg.s frd, frs1</sub></code></td>
      <td style="text-align: left"><code><sub>fsgnjn.s frd, frs, frs</sub></code></td>
      <td style="text-align: left"><sub>Single-precision negate</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>fmv.d frd, frs1</sub></code></td>
      <td style="text-align: left"><code><sub>fsgnj.d frd, frs, frs</sub></code></td>
      <td style="text-align: left"><sub>Double-precision move</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>fabs.d frd, frs1</sub></code></td>
      <td style="text-align: left"><code><sub>fsgnjx.d frd, frs, frs</sub></code></td>
      <td style="text-align: left"><sub>Double-precision absolute value</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>fneg.d frd, frs1</sub></code></td>
      <td style="text-align: left"><code><sub>fsgnjn.d frd, frs, frs</sub></code></td>
      <td style="text-align: left"><sub>Double-precision negate</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>beqz rs1, offset</sub></code></td>
      <td style="text-align: left"><code><sub>beq rs, x0, offset</sub></code></td>
      <td style="text-align: left"><sub>Branch if = zero</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>bnez rs1, offset</sub></code></td>
      <td style="text-align: left"><code><sub>bne rs, x0, offset</sub></code></td>
      <td style="text-align: left"><sub>Branch if ≠ zero</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>blez rs1, offset</sub></code></td>
      <td style="text-align: left"><code><sub>bge x0, rs, offset</sub></code></td>
      <td style="text-align: left"><sub>Branch if ≤ zero</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>bgez rs1, offset</sub></code></td>
      <td style="text-align: left"><code><sub>bge rs, x0, offset</sub></code></td>
      <td style="text-align: left"><sub>Branch if ≥ zero</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>bltz rs1, offset</sub></code></td>
      <td style="text-align: left"><code><sub>blt rs, x0, offset</sub></code></td>
      <td style="text-align: left"><sub>Branch if &lt; zero</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>bgtz rs1, offset</sub></code></td>
      <td style="text-align: left"><code><sub>blt x0, rs, offset</sub></code></td>
      <td style="text-align: left"><sub>Branch if &gt; zero</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>bgt rs, rt, offset</sub></code></td>
      <td style="text-align: left"><code><sub>blt rt, rs, offset</sub></code></td>
      <td style="text-align: left"><sub>Branch if &gt;</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>ble rs, rt, offset</sub></code></td>
      <td style="text-align: left"><code><sub>bge rt, rs, offset</sub></code></td>
      <td style="text-align: left"><sub>Branch if ≤</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>bgtu rs, rt, offset</sub></code></td>
      <td style="text-align: left"><code><sub>bltu rt, rs, offset</sub></code></td>
      <td style="text-align: left"><sub>Branch if &gt;, unsigned</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>bleu rs, rt, offset</sub></code></td>
      <td style="text-align: left"><code><sub>bltu rt, rs, offset</sub></code></td>
      <td style="text-align: left"><sub>Branch if ≤, unsigned</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>j offset</sub></code></td>
      <td style="text-align: left"><code><sub>jal x0, offset</sub></code></td>
      <td style="text-align: left"><sub>Jump</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>jr offset</sub></code></td>
      <td style="text-align: left"><code><sub>jal x1, offset</sub></code></td>
      <td style="text-align: left"><sub>Jump register</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>ret</sub></code></td>
      <td style="text-align: left"><code><sub>jalr x0, x1, 0</sub></code></td>
      <td style="text-align: left"><sub>Return from subroutine</sub></td>
    </tr>
  </tbody>
</table>

<h3 id="relocation-functions">Relocation Functions</h3>

<p>The relocation function directives create synthesize operand values
that are resolved at program link time and are used as immediate parameters
to specific instructions. The sections on absolute and relative addressing
give examples of using the relocation functions.</p>

<p>The following table lists assembler functions used to generate relocations:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Assembler Notation</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Instructions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code><sub>%hi(symbol)</sub></code></td>
      <td style="text-align: left"><sub>Absolute (HI20)</sub></td>
      <td style="text-align: left"><sub>lui</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>%lo(symbol)</sub></code></td>
      <td style="text-align: left"><sub>Absolute (LO12)</sub></td>
      <td style="text-align: left"><sub>loads, stores, adds</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>%pcrel_hi(symbol)</sub></code></td>
      <td style="text-align: left"><sub>PC-relative (HI20)</sub></td>
      <td style="text-align: left"><sub>auipc</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>%pcrel_lo(label)</sub></code></td>
      <td style="text-align: left"><sub>PC-relative (LO12)</sub></td>
      <td style="text-align: left"><sub>loads, stores, adds</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>%tprel_hi(symbol)</sub></code></td>
      <td style="text-align: left"><sub>TLS LE (Local Exec)</sub></td>
      <td style="text-align: left"><sub>auipc</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>%tprel_lo(label)</sub></code></td>
      <td style="text-align: left"><sub>TLS LE (Local Exec)</sub></td>
      <td style="text-align: left"><sub>loads, stores, adds</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>%tprel_add(offset)</sub></code></td>
      <td style="text-align: left"><sub>TLS LE (Local Exec)</sub></td>
      <td style="text-align: left"><sub>add</sub></td>
    </tr>
  </tbody>
</table>

<h3 id="labels">Labels</h3>

<p>Text labels are used as branch, unconditional jump targets and symbol offsets.
Text labels are added to the symbol table of the compiled module.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>loop:
        j loop
</code></pre></div></div>

<p>Numeric labels are used for local references. References to local labels are
suffixed with ‘f’ for a forward reference or ‘b’ for a backwards reference.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1:
        j 1b
</code></pre></div></div>

<h3 id="absolute-addressing">Absolute Addressing</h3>

<p>Absolute addresses are used in position dependent code. An
absolute address is formed using two instructions, the U-Type
<code class="language-plaintext highlighter-rouge">lui</code> <em>(Load Upper Immediate)</em> instruction to load <code class="language-plaintext highlighter-rouge">bits[31:20]</code>
and an I-Type or S-Type instruction such as <code class="language-plaintext highlighter-rouge">addi</code> <em>(add
immediate)</em>, <code class="language-plaintext highlighter-rouge">lw</code> <em>(load word)</em> or <code class="language-plaintext highlighter-rouge">sw</code> <em>(store word)</em> that
fills in the low 12 bits relative to the upper immediate.</p>

<p>The following example shows how to load an absolute address:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.section .text
.globl _start
_start:
	    lui  a1,      %hi(msg)       # load msg(hi)
	    addi a1, a1,  %lo(msg)       # load msg(lo)
	    jalr ra, puts
2:	    j    2b

.section .rodata
msg:
	    .string "Hello World\n"
</code></pre></div></div>

<p>which generates the following assembler output and relocations
as seen by objdump:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0000000000000000 &lt;_start&gt;:
   0:	000005b7          	lui	a1,0x0
			0: R_RISCV_HI20	msg
   4:	00858593          	addi	a1,a1,8 # 8 &lt;.L21&gt;
			4: R_RISCV_LO12_I	msg
</code></pre></div></div>

<h3 id="relative-addressing">Relative Addressing</h3>

<p>Relative addresses are used in position independent code. A
PC-relative address is formed using two instructions, the U-Type
<code class="language-plaintext highlighter-rouge">auipc</code> <em>(Add Upper Immediate Program Counter)</em> instruction to
load <code class="language-plaintext highlighter-rouge">bits[31:20]</code> relative to the program counter of the <code class="language-plaintext highlighter-rouge">auipc</code>
instruction followed by an I-Type or S-Type instruction such as
<code class="language-plaintext highlighter-rouge">addi</code> <em>(add immediate)</em>, <code class="language-plaintext highlighter-rouge">lw</code> <em>(load word)</em> or <code class="language-plaintext highlighter-rouge">sw</code> <em>(store word)</em>.</p>

<p>The following example shows how to load a PC-relative address:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.section .text
.globl _start
_start:
1:	    auipc a1,     %pcrel_hi(msg) # load msg(hi)
	    addi  a1, a1, %pcrel_lo(1b)  # load msg(lo)
	    jalr  ra, puts
2:	    j     2b

.section .rodata
msg:
	    .string "Hello World\n"
</code></pre></div></div>

<p>which generates the following assembler output and relocations
as seen by objdump:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0000000000000000 &lt;_start&gt;:
   0:	00000597          	auipc	a1,0x0
			0: R_RISCV_PCREL_HI20	msg
   4:	00858593          	addi	a1,a1,8 # 8 &lt;.L21&gt;
			4: R_RISCV_PCREL_LO12_I	.L11
</code></pre></div></div>

<h3 id="load-immediate">Load Immediate</h3>

<p>The <code class="language-plaintext highlighter-rouge">li</code> <em>(load immediate)</em> instruction is an assembler pseudo
instruction that is used to synthesize constants. The <code class="language-plaintext highlighter-rouge">li</code> pseudo
instruction will emit a sequence starting with <code class="language-plaintext highlighter-rouge">lui</code> followed by
<code class="language-plaintext highlighter-rouge">addi</code> and <code class="language-plaintext highlighter-rouge">slli</code> <em>(shift left logical immediate)</em> to construct
constants by shifting and adding.</p>

<p>The following example shows the <code class="language-plaintext highlighter-rouge">li</code> psuedo instruction being used
to load an immediate value:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.section .text
.globl _start
_start:

.equ CONSTANT, 0xcafebabe

        li a0, CONSTANT
</code></pre></div></div>

<p>which generates the following assembler output as seen by objdump:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0000000000000000 &lt;_start&gt;:
   0:	00032537          	lui     a0,0x32
   4:	bfb50513          	addi    a0,a0,-1029
   8:	00e51513          	slli    a0,a0,0xe
   c:	abe50513          	addi    a0,a0,-1346
</code></pre></div></div>

<h3 id="load-address">Load Address</h3>

<p>The <code class="language-plaintext highlighter-rouge">la</code> <em>(load address)</em> instruction is an assembler pseudo-
instruction used to load the address of a symbol or label. The
instruction can emit absolute or relative addresses depending
on the <code class="language-plaintext highlighter-rouge">-fpic</code> or <code class="language-plaintext highlighter-rouge">-fno-pic</code> assembler command line options or
an <code class="language-plaintext highlighter-rouge">.options pic</code> or <code class="language-plaintext highlighter-rouge">.options nopic</code> assembler directive. The
pseduo-instruction emits a relocation so that the address of
the symbol can be fixed up during program linking.</p>

<p>The following example uses the <code class="language-plaintext highlighter-rouge">la</code> psuedo instruction to load
a symbol address:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.section .text
.globl _start
_start:

        la a0, msg

.section .rodata
msg:
	    .string "Hello World\n"
</code></pre></div></div>

<p>which generates the following assembler output and relocations
as seen by objdump:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0000000000000000 &lt;_start&gt;:
   0:	00000517          	auipc	a0,0x0
			0: R_RISCV_PCREL_HI20	msg
   4:	00850513          	addi	a0,a0,8 # 8 &lt;_start+0x8&gt;
			4: R_RISCV_PCREL_LO12_I	.L11
</code></pre></div></div>

<h3 id="constants">Constants</h3>

<p>Constants are emitted to the symbol table of the object but they
do not take any space in the code or data sections. Constants
can be referenced in expressions which emit relocations.</p>

<p>The following example shows loading a constant using the <code class="language-plaintext highlighter-rouge">%hi</code> and
<code class="language-plaintext highlighter-rouge">%lo</code> assembler functions.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.equ UART_BASE, 0x40003000

        lui a0,      %hi(UART_BASE)
        addi a0, a0, %lo(UART_BASE)
</code></pre></div></div>

<p>This example uses the <code class="language-plaintext highlighter-rouge">li</code> pseudo instruction to load a constant
and writes a string using polled IO to a UART:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.equ UART_BASE,  0x40003000
.equ REG_RBR,    0
.equ REG_TBR,    0
.equ REG_IIR,    2
.equ IIR_TX_RDY, 2
.equ IIR_RX_RDY, 4

.section .text
.globl _start
_start:
1:      auipc a0, %pcrel_hi(msg)    # load msg(hi)
        addi  a0, a0, %pcrel_lo(1b)  # load msg(lo)
2:      jal   ra, puts
3:      j     3b

puts:
        li    a2, UART_BASE
1:      lbu   a1, (a0)
        beqz  a1, 3f
2:      lbu   a3, REG_IIR(a2)
        andi  a3, a3, IIR_TX_RDY
        beqz  a3, 2b
        sb    a1, REG_TBR(a2)
        addi  a0, a0, 1
        j     1b
3:      ret

.section .rodata
msg:
	    .string "Hello World\n"
</code></pre></div></div>

<h3 id="control-and-status-registers">Control and Status Registers</h3>

<p>Control and status registers are typically used to update
privileged processor state however there are a few non-privileged
instructions that access control and status registers such
as the CSR pseudo-instructions <code class="language-plaintext highlighter-rouge">rdcycle</code>, <code class="language-plaintext highlighter-rouge">rdtime</code>, <code class="language-plaintext highlighter-rouge">rdinstret</code>
for access to counters and <code class="language-plaintext highlighter-rouge">frcsr</code>, <code class="language-plaintext highlighter-rouge">frrm</code>, <code class="language-plaintext highlighter-rouge">frflags</code>, <code class="language-plaintext highlighter-rouge">fscsr</code>,
<code class="language-plaintext highlighter-rouge">fsrm</code>, <code class="language-plaintext highlighter-rouge">fsflags</code>, <code class="language-plaintext highlighter-rouge">fsrmi</code> and <code class="language-plaintext highlighter-rouge">fsflagsi</code> for controling round
mode and accessing floating point accrued exception state.</p>

<p>The following instructions allow reading, writing, setting and
clearing bits in CSRs <em>(control and status registers)</em>:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">CSR Operation</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code><sub>CSRRW rd, csr, rs1</sub></code></td>
      <td style="text-align: left"><sub>Control and Status Register Atomic Read and Write</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>CSRRS rd, csr, rs1</sub></code></td>
      <td style="text-align: left"><sub>Control and Status Register Atomic Read and Set Bits</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>CSRRC rd, csr, rs1</sub></code></td>
      <td style="text-align: left"><sub>Control and Status Register Atomic Read and Clear Bits</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>CSRRWI rd, csr, imm5</sub></code></td>
      <td style="text-align: left"><sub>Control and Status Register Atomic Read and Write Immediate</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>CSRRSI rd, csr, imm5</sub></code></td>
      <td style="text-align: left"><sub>Control and Status Register Atomic Read and Set Bits Immediate</sub></td>
    </tr>
    <tr>
      <td style="text-align: left"><code><sub>CSRRCI rd, csr, imm5</sub></code></td>
      <td style="text-align: left"><sub>Control and Status Register Atomic Read and Write Immediate</sub></td>
    </tr>
  </tbody>
</table>

<p>The following code sample shows how to enable interrupts, enable
timer interuppts, and then set and wait for a timer interrupt to
occur. The example uses CSR instructions and access to a platform
specific MMIO <em>(memory mapped input output)</em> region:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.equ RTC_BASE,      0x40000000
.equ TIMER_BASE,    0x40004000

# setup machine trap vector
1:      auipc   t0, %pcrel_hi(mtvec)        # load mtvec(hi)
        addi    t0, t0, %pcrel_lo(1b)       # load mtvec(lo)
        csrrw   zero, mtvec, t0

# set mstatus.MIE=1 (enable M mode interrupt)
        li      t0, 8
        csrrs   zero, mstatus, t0

# set mie.MTIE=1 (enable M mode timer interrupts)
        li      t0, 128
        csrrs   zero, mie, t0

# read from mtime
        li      a0, RTC_BASE
        ld      a1, 0(a0)

# write to mtimecmp
        li      a0, TIMER_BASE
        li      t0, 1000000000
        add     a1, a1, t0
        sd      a1, 0(a0)

# loop
loop:
        wfi
        j loop

# break on interrupt
mtvec:
        csrrc   t0, mcause, zero
        bgez    t0, fail       # interrupt causes are less than zero
        slli    t0, t0, 1      # shift off high bit
        srli    t0, t0, 1
        li      t1, 7          # check this is an m_timer interrupt
        bne t0, t1, fail
        j pass

pass:
        la      a0, pass_msg
        jal     puts
        j       shutdown

fail:
        la      a0, fail_msg
        jal     puts
        j       shutdown

.section .rodata

pass_msg:
        .string "PASS\n"

fail_msg:
        .string "FAIL\n"
</code></pre></div></div>

<h3 id="references">References</h3>

<ul>
  <li><a href="http://riscv.org/">RISC-V Foundation</a></li>
  <li><a href="http://riscv.org/specifications/">RISC-V ISA Specification</a></li>
  <li><a href="https://github.com/riscv/riscv-gnu-toolchain/">RISC-V GNU Toolchain</a></li>
</ul>


      <footer class="site-footer">
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com/">GitHub Pages</a>.</span>
      </footer>
    </main>
  

</body></html>